<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular IQ - Modo Oscuro</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --header-bg: #1e293b;
            --card-bg: #1e293b;
            --card-hover: #334155;
            --primary: #38bdf8;
            --success: #10b981;
            --locked: #475569;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: var(--header-bg);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        h1 { margin: 0; color: var(--primary); font-size: 1.8rem; }

        .stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            padding: 8px 16px;
            border-radius: 12px;
            background: #0ea5e920;
            color: var(--primary);
            border: 1px solid #0ea5e940;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .malla-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            min-width: 1200px;
        }

        .semestre-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .semestre-header {
            text-align: center;
            padding: 10px;
            background: var(--primary);
            color: #0f172a;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .category-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 10px 0 5px 0;
            padding-left: 5px;
            border-left: 2px solid var(--primary);
        }

        .materia {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            user-select: none;
        }

        .materia:not(.locked):hover {
            border-color: var(--primary);
            background: var(--card-hover);
            transform: scale(1.02);
        }

        .materia.approved {
            background-color: var(--success);
            border-color: #059669;
            color: white;
        }

        .materia.locked {
            opacity: 0.5;
            background-color: #0f172a;
            border-style: dashed;
            cursor: not-allowed;
        }

        .materia-name {
            font-size: 0.85rem;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .materia-credits {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .approved .materia-credits { color: #d1fae5; }

        /* Tooltip */
        .materia .tooltip {
            visibility: hidden;
            width: 180px;
            background-color: #f1f5f9;
            color: #0f172a;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .materia:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .btn-reset {
            margin-top: 15px;
            background: transparent;
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: 0.3s;
        }

        .btn-reset:hover { background: #ef4444; color: white; }

        @media (max-width: 1200px) {
            .malla-container { grid-template-columns: repeat(2, 1fr); min-width: auto; }
        }
    </style>
</head>
<body>

<header>
    <h1>Ingeniería Química - Malla Curricular</h1>
    <div class="stats">
        <div class="stat-item" id="total-stat">Créditos Totales: 0</div>
        <div class="stat-item" id="disc-stat">Créditos Disciplinares: 0</div>
    </div>
    <button class="btn-reset" onclick="resetApp()">Reiniciar Todo</button>
</header>

<div class="malla-container" id="malla"></div>

<script>
    const materiasData = [
        { sem: 1, mat: [
            { id: "A", n: "Principios de Química", c: 3, r: [], cat: "Fundamentación" },
            { id: "LTB", n: "Lab. Técnicas Básicas", c: 3, r: [], cat: "Fundamentación" },
            { id: "B", n: "Cálculo Diferencial", c: 4, r: [], cat: "Fundamentación" },
            { id: "OHI", n: "Opt. Herramientas Ing.", c: 3, r: [], cat: "Fundamentación" },
            { id: "IIQ", n: "Intro. Ing. Química", c: 3, r: [], cat: "Disciplinar" }
        ]},
        { sem: 2, mat: [
            { id: "PAQ", n: "Principios Análisis Químico", c: 3, r: ["A"], cat: "Fundamentación" },
            { id: "C", n: "Álgebra Lineal", c: 4, r: ["B"], cat: "Fundamentación" },
            { id: "D", n: "Cálculo Integral", c: 4, r: ["B"], cat: "Fundamentación" },
            { id: "E", n: "Fundamentos de Mecánica", c: 4, r: ["B"], cat: "Fundamentación" },
            { id: "LL", n: "Balance de Materia", c: 3, r: [], cat: "Disciplinar" }
        ]},
        { sem: 3, mat: [
            { id: "LPAQ", n: "Lab. Princ. Análisis Q.", c: 3, r: ["A"], cat: "Fundamentación" },
            { id: "BIO", n: "Biología Molecular", c: 3, r: [], cat: "Fundamentación" },
            { id: "F", n: "Cálculo Varias Variables", c: 4, r: ["C", "D"], cat: "Fundamentación" },
            { id: "FEM", n: "Fund. Elec. y Magnetismo", c: 4, r: ["D", "E"], cat: "Fundamentación" },
            { id: "G", n: "Termodinámica", c: 3, r: ["LL"], cat: "Disciplinar" },
            { id: "L1", n: "Libre Elección", c: 3, r: [], cat: "Libre" }
        ]},
        { sem: 4, mat: [
            { id: "QO", n: "Química Orgánica", c: 3, r: ["A"], cat: "Fundamentación" },
            { id: "PRO", n: "Probabilidad y Est.", c: 3, r: ["B"], cat: "Fundamentación" },
            { id: "H", n: "Ec. Diferenciales", c: 4, r: ["C", "D"], cat: "Fundamentación" },
            { id: "KK", n: "Fluidos", c: 3, r: ["E", "G"], cat: "Disciplinar" },
            { id: "T1", n: "Taller 1", c: 1, r: ["F", "G"], cat: "Disciplinar" },
            { id: "HH", n: "Termodinámica Química", c: 3, r: ["F", "G"], cat: "Disciplinar" }
        ]},
        { sem: 5, mat: [
            { id: "QO2", n: "Química Orgánica II", c: 3, r: ["A"], cat: "Fundamentación" },
            { id: "J", n: "Métodos Numéricos", c: 3, r: ["H"], cat: "Fundamentación" },
            { id: "K", n: "Transferencia Calor", c: 4, r: ["G", "H"], cat: "Disciplinar" },
            { id: "JJ", n: "Manejo de Sólidos", c: 3, r: ["KK"], cat: "Disciplinar" },
            { id: "L", n: "Bal. Energía y Equil.", c: 3, r: ["HH"], cat: "Disciplinar" },
            { id: "L2", n: "Libre Elección", c: 3, r: [], cat: "Libre" }
        ]},
        { sem: 6, mat: [
            { id: "LQO", n: "Lab. Química Orgánica", c: 2, r: ["A"], cat: "Fundamentación" },
            { id: "UU", n: "Ingeniería Económica", c: 3, r: ["D"], cat: "Fundamentación" },
            { id: "M", n: "Transferencia Masa", c: 3, r: ["H"], cat: "Disciplinar" },
            { id: "T2", n: "Taller 2", c: 1, r: ["H"], cat: "Disciplinar" },
            { id: "LPT", n: "Lab. Prop. Termo.", c: 3, r: ["L"], cat: "Disciplinar" },
            { id: "OT", n: "Opt. Termodinámica", c: 3, r: ["L"], cat: "Disciplinar" },
            { id: "L3", n: "Libre Elección", c: 3, r: [], cat: "Libre" }
        ]},
        { sem: 7, mat: [
            { id: "OEA", n: "Opt. Econ-Admin", c: 3, r: [], cat: "Fundamentación" },
            { id: "GGP", n: "Gerencia Proyectos", c: 3, r: ["UU"], cat: "Fundamentación" },
            { id: "O", n: "Operaciones Separación", c: 3, r: ["M", "L"], cat: "Disciplinar" },
            { id: "LF", n: "Lab. Fluidos y Calor", c: 3, r: ["K"], cat: "Disciplinar" },
            { id: "N", n: "Ing. Reacciones Quím.", c: 3, r: ["L"], cat: "Disciplinar" },
            { id: "L4", n: "Libre Elección", c: 3, r: [], cat: "Libre" }
        ]},
        { sem: 8, mat: [
            { id: "OM", n: "Optativa Materiales", c: 3, r: ["TOTAL_108"], cat: "Disciplinar" },
            { id: "TT", n: "Control de Procesos", c: 3, r: ["J", "N"], cat: "Disciplinar" },
            { id: "LSC", n: "Lab. Sep/Reac/Contr", c: 3, r: ["O", "TT"], cat: "Disciplinar" },
            { id: "OPQ", n: "Opt. Proc. Químicos", c: 3, r: ["M", "N"], cat: "Disciplinar" },
            { id: "P", n: "Diseño Procesos Q.", c: 3, r: ["L"], cat: "Disciplinar" },
            { id: "L5", n: "Libre Elección", c: 4, r: [], cat: "Libre" }
        ]},
        { sem: 9, mat: [
            { id: "TPI", n: "Taller Proy. Inter.", c: 3, r: ["DISC_53"], cat: "Disciplinar" },
            { id: "DPE", n: "Dis. Plantas y Equip.", c: 3, r: ["O", "P"], cat: "Disciplinar" },
            { id: "IP", n: "Ingeniería Procesos", c: 3, r: ["P"], cat: "Disciplinar" },
            { id: "L6", n: "Libre Elección", c: 3, r: [], cat: "Libre" },
            { id: "L7", n: "Libre Elección", c: 4, r: [], cat: "Libre" }
        ]},
        { sem: 10, mat: [
            { id: "TG", n: "Trabajo de Grado", c: 6, r: ["DISC_60"], cat: "Disciplinar" },
            { id: "L8", n: "Libre Elección", c: 3, r: [], cat: "Libre" },
            { id: "L9", n: "Libre Elección", c: 3, r: [], cat: "Libre" },
            { id: "L10", n: "Libre Elección", c: 3, r: [], cat: "Libre" },
            { id: "L11", n: "Libre Elección", c: 4, r: [], cat: "Libre" }
        ]}
    ];

    let approved = JSON.parse(localStorage.getItem('malla_iq_save')) || [];

    function save() {
        localStorage.setItem('malla_iq_save', JSON.stringify(approved));
    }

    function getStats() {
        let t = 0, d = 0;
        materiasData.forEach(s => s.mat.forEach(m => {
            if(approved.includes(m.id)) {
                t += m.c;
                if(m.cat === "Disciplinar") d += m.c;
            }
        }));
        return { total: t, disc: d };
    }

    function getName(id) {
        for(let s of materiasData) {
            let m = s.mat.find(x => x.id === id);
            if(m) return m.n;
        }
        return id;
    }

    function checkRequirements(reqList) {
        const stats = getStats();
        let missing = [];
        
        reqList.forEach(r => {
            if(r === "TOTAL_108") { if(stats.total < 108) missing.push(`108 cred totales (Llevas ${stats.total})`); }
            else if(r === "DISC_53") { if(stats.disc < 53) missing.push(`53 cred disc. (Llevas ${stats.disc})`); }
            else if(r === "DISC_60") { if(stats.disc < 60) missing.push(`60 cred disc. (Llevas ${stats.disc})`); }
            else if(!approved.includes(r)) {
                missing.push(getName(r));
            }
        });
        return missing;
    }

    function handleMateriaClick(id, isLocked) {
        if(isLocked && !approved.includes(id)) return;
        
        if(approved.includes(id)) {
            approved = approved.filter(x => x !== id);
        } else {
            approved.push(id);
        }
        save();
        render();
    }

    function render() {
        const container = document.getElementById('malla');
        const stats = getStats();
        document.getElementById('total-stat').innerText = `Créditos Totales: ${stats.total}`;
        document.getElementById('disc-stat').innerText = `Créditos Disciplinares: ${stats.disc}`;
        
        container.innerHTML = '';

        materiasData.forEach(semestre => {
            const col = document.createElement('div');
            col.className = 'semestre-col';
            col.innerHTML = `<div class="semestre-header">Semestre ${semestre.sem}</div>`;
            
            let lastCat = "";
            semestre.mat.forEach(m => {
                if(m.cat !== lastCat) {
                    col.innerHTML += `<div class="category-label">${m.cat}</div>`;
                    lastCat = m.cat;
                }

                const missing = checkRequirements(m.r);
                const isLocked = missing.length > 0;
                const isApproved = approved.includes(m.id);

                const card = document.createElement('div');
                card.className = `materia ${isApproved ? 'approved' : ''} ${(isLocked && !isApproved) ? 'locked' : ''}`;
                
                // Evento directo
                card.onclick = () => handleMateriaClick(m.id, isLocked);

                let tooltipText = isApproved ? "Click para desmarcar" : (isLocked ? "Falta: " + missing.join(", ") : "Click para aprobar");

                card.innerHTML = `
                    <span class="materia-name">${m.n}</span>
                    <span class="materia-credits">${m.c} Créditos</span>
                    <div class="tooltip">${tooltipText}</div>
                `;
                
                col.appendChild(card);
            });
            container.appendChild(col);
        });
    }

    function resetApp() {
        if(confirm("¿Estás seguro de reiniciar todo el progreso?")) {
            approved = [];
            save();
            render();
        }
    }

    // Inicialización
    render();
</script>

</body>
</html>
