<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular - Ingeniería Química</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --primary: #2563eb;
            --success: #059669;
            --locked: #d1d5db;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-weight: 600;
        }

        .stat-item { padding: 5px 15px; border-radius: 20px; background: #e0e7ff; color: var(--primary); font-size: 0.9rem; }

        .malla-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            align-items: start;
        }

        .semestre-col {
            background: rgba(255,255,255,0.5);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .semestre-title {
            font-size: 0.85rem;
            font-weight: 700;
            text-align: center;
            padding: 10px;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .category-label {
            font-size: 0.65rem;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            margin: 15px 0 5px 5px;
            display: block;
            border-left: 3px solid var(--primary);
            padding-left: 5px;
        }

        .materia {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .materia:hover:not(.locked) {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .materia.approved {
            background-color: var(--success);
            border-color: #047857;
            color: white;
        }

        .materia.locked {
            background-color: #e5e7eb;
            border-color: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .materia-name { font-size: 0.8rem; font-weight: 600; display: block; line-height: 1.2; }
        .materia-credits { font-size: 0.7rem; opacity: 0.8; }

        /* Tooltip mejorado */
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 105%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            z-index: 100;
            width: 140px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button.reset-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }

        @media (max-width: 1000px) { .malla-container { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .malla-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <h1>Malla Curricular Interactiva</h1>
    <h3>Ingeniería Química</h3>
    <div class="stats">
        <div class="stat-item" id="total-creds">Total Créditos: 0</div>
        <div class="stat-item" id="disc-creds">Créditos Disciplinares: 0</div>
    </div>
    <button class="reset-btn" onclick="resetProgreso()">Reiniciar Progreso</button>
</header>

<div class="malla-container" id="malla"></div>

<script>
    const data = [
        { sem: 1, mat: [
            { id: "A", name: "Principios de Química", cred: 3, req: [], cat: "Fundamentación" },
            { id: "LTB", name: "Lab. Técnicas Básicas", cred: 3, req: [], cat: "Fundamentación" },
            { id: "B", name: "Cálculo Diferencial", cred: 4, req: [], cat: "Fundamentación" },
            { id: "OHI", name: "Opt. Herramientas Ing.", cred: 3, req: [], cat: "Fundamentación" },
            { id: "IIQ", name: "Intro. Ing. Química", cred: 3, req: [], cat: "Disciplinar" }
        ]},
        { sem: 2, mat: [
            { id: "PAQ", name: "Principios Análisis Químico", cred: 3, req: ["A"], cat: "Fundamentación" },
            { id: "C", name: "Álgebra Lineal", cred: 4, req: ["B"], cat: "Fundamentación" },
            { id: "D", name: "Cálculo Integral", cred: 4, req: ["B"], cat: "Fundamentación" },
            { id: "E", name: "Fundamentos de Mecánica", cred: 4, req: ["B"], cat: "Fundamentación" },
            { id: "LL", name: "Balance de Materia", cred: 3, req: [], cat: "Disciplinar" }
        ]},
        { sem: 3, mat: [
            { id: "LPAQ", name: "Lab. Principios Análisis Q.", cred: 3, req: ["A"], cat: "Fundamentación" },
            { id: "BIO", name: "Biología Molecular", cred: 3, req: [], cat: "Fundamentación" },
            { id: "F", name: "Cálculo Varias Variables", cred: 4, req: ["C", "D"], cat: "Fundamentación" },
            { id: "FEM", name: "Fund. Elec. y Magnetismo", cred: 4, req: ["D", "E"], cat: "Fundamentación" },
            { id: "G", name: "Termodinámica", cred: 3, req: ["LL"], cat: "Disciplinar" },
            { id: "L1", name: "Libre Elección", cred: 3, req: [], cat: "Libre" }
        ]},
        { sem: 4, mat: [
            { id: "QO", name: "Principios Química Orgánica", cred: 3, req: ["A"], cat: "Fundamentación" },
            { id: "PROB", name: "Probabilidad y Estadística", cred: 3, req: ["B"], cat: "Fundamentación" },
            { id: "H", name: "Ecuaciones Diferenciales", cred: 4, req: ["C", "D"], cat: "Fundamentación" },
            { id: "KK", name: "Fluidos", cred: 3, req: ["E", "G"], cat: "Disciplinar" },
            { id: "T1", name: "Taller 1", cred: 1, req: ["F", "G"], cat: "Disciplinar" },
            { id: "HH", name: "Termodinámica Química", cred: 3, req: ["F", "G"], cat: "Disciplinar" }
        ]},
        { sem: 5, mat: [
            { id: "QO2", name: "Principios Química Orgánica (II)", cred: 3, req: ["A"], cat: "Fundamentación" },
            { id: "J", name: "Métodos Numéricos", cred: 3, req: ["H"], cat: "Fundamentación" },
            { id: "K", name: "Transferencia de Calor", cred: 4, req: ["G", "H"], cat: "Disciplinar" },
            { id: "JJ", name: "Manejo de Sólidos", cred: 3, req: ["KK"], cat: "Disciplinar" },
            { id: "L", name: "Balance Energía y Equil.", cred: 3, req: ["HH"], cat: "Disciplinar" },
            { id: "L2", name: "Libre Elección", cred: 3, req: [], cat: "Libre" }
        ]},
        { sem: 6, mat: [
            { id: "LQO", name: "Lab. Química Orgánica", cred: 2, req: ["A"], cat: "Fundamentación" },
            { id: "UU", name: "Ingeniería Económica", cred: 3, req: ["D"], cat: "Fundamentación" },
            { id: "M", name: "Transferencia de Masa", cred: 3, req: ["H"], cat: "Disciplinar" },
            { id: "T2", name: "Taller 2", cred: 1, req: ["H"], cat: "Disciplinar" },
            { id: "LPT", name: "Lab. Propiedades Termo.", cred: 3, req: ["L"], cat: "Disciplinar" },
            { id: "OT", name: "Optativa Termodinámica", cred: 3, req: ["L"], cat: "Disciplinar" },
            { id: "L3", name: "Libre Elección", cred: 3, req: [], cat: "Libre" }
        ]},
        { sem: 7, mat: [
            { id: "OEA", name: "Optativa Econ-Admin", cred: 3, req: [], cat: "Fundamentación" },
            { id: "GGP", name: "Gerencia Proyectos", cred: 3, req: ["UU"], cat: "Fundamentación" },
            { id: "O", name: "Operaciones Separación", cred: 3, req: ["M", "L"], cat: "Disciplinar" },
            { id: "LF", name: "Lab. Fluidos y Calor", cred: 3, req: ["K"], cat: "Disciplinar" },
            { id: "N", name: "Ing. Reacciones Química", cred: 3, req: ["L"], cat: "Disciplinar" },
            { id: "L4", name: "Libre Elección", cred: 3, req: [], cat: "Libre" }
        ]},
        { sem: 8, mat: [
            { id: "OM", name: "Optativa Materiales", cred: 3, req: ["TOTAL_108"], cat: "Disciplinar" },
            { id: "TT", name: "Control de Procesos", cred: 3, req: ["J", "N"], cat: "Disciplinar" },
            { id: "LSC", name: "Lab. Sep/Reacc/Control", cred: 3, req: ["O", "TT"], cat: "Disciplinar" },
            { id: "OPB", name: "Opt. Proc. Bioquímicos", cred: 3, req: ["M", "N"], cat: "Disciplinar" },
            { id: "P", name: "Diseño Proc. Químicos", cred: 3, req: ["L"], cat: "Disciplinar" },
            { id: "L5", name: "Libre Elección", cred: 4, req: [], cat: "Libre" }
        ]},
        { sem: 9, mat: [
            { id: "TPI", name: "Taller Proy. Interdisc.", cred: 3, req: ["DISC_53"], cat: "Disciplinar" },
            { id: "DPE", name: "Diseño Plantas y Equipos", cred: 3, req: ["O", "P"], cat: "Disciplinar" },
            { id: "IP", name: "Ingeniería de Procesos", cred: 3, req: ["P"], cat: "Disciplinar" },
            { id: "L6", name: "Libre Elección", cred: 3, req: [], cat: "Libre" },
            { id: "L7", name: "Libre Elección", cred: 4, req: [], cat: "Libre" }
        ]},
        { sem: 10, mat: [
            { id: "TG", name: "Trabajo de Grado", cred: 6, req: ["DISC_60"], cat: "Disciplinar" },
            { id: "L8", name: "Libre Elección", cred: 3, req: [], cat: "Libre" },
            { id: "L9", name: "Libre Elección", cred: 3, req: [], cat: "Libre" },
            { id: "L10", name: "Libre Elección", cred: 3, req: [], cat: "Libre" },
            { id: "L11", name: "Libre Elección", cred: 4, req: [], cat: "Libre" }
        ]}
    ];

    let approved = JSON.parse(localStorage.getItem('iqProgreso')) || [];

    function getStats() {
        let total = 0, disc = 0;
        data.forEach(s => s.mat.forEach(m => {
            if(approved.includes(m.id)) {
                total += m.cred;
                if(m.cat === "Disciplinar") disc += m.cred;
            }
        }));
        return { total, disc };
    }

    function checkReqs(materiaId) {
        let mat = null;
        data.forEach(s => { const found = s.mat.find(m => m.id === materiaId); if(found) mat = found; });
        if(!mat) return { ok: true };

        const stats = getStats();
        let missing = [];

        mat.req.forEach(r => {
            if(r === "TOTAL_108") { if(stats.total < 108) missing.push("108 créditos totales"); }
            else if(r === "DISC_53") { if(stats.disc < 53) missing.push("53 créditos disc."); }
            else if(r === "DISC_60") { if(stats.disc < 60) missing.push("60 créditos disc."); }
            else if(!approved.includes(r)) {
                let rMatName = r;
                data.forEach(s => { const f = s.mat.find(m => m.id === r); if(f) rMatName = f.name; });
                missing.push(rMatName);
            }
        });
        return { ok: missing.length === 0, missing };
    }

    function toggleMateria(id) {
        const { ok } = checkReqs(id);
        if(!ok && !approved.includes(id)) return; // No hace nada si está bloqueada y quieres aprobar

        if(approved.includes(id)) {
            approved = approved.filter(m => m !== id);
        } else {
            approved.push(id);
        }
        localStorage.setItem('iqProgreso', JSON.stringify(approved));
        render();
    }

    function render() {
        const container = document.getElementById('malla');
        const stats = getStats();
        document.getElementById('total-creds').innerText = `Total Créditos: ${stats.total}`;
        document.getElementById('disc-creds').innerText = `Créditos Disciplinares: ${stats.disc}`;
        
        container.innerHTML = '';

        data.forEach(semestre => {
            const col = document.createElement('div');
            col.className = 'semestre-col';
            col.innerHTML = `<div class="semestre-title">Semestre ${semestre.sem}</div>`;
            
            let currentCat = "";
            semestre.mat.forEach(m => {
                if(m.cat !== currentCat) {
                    col.innerHTML += `<span class="category-label">${m.cat}</span>`;
                    currentCat = m.cat;
                }

                const { ok, missing } = checkReqs(m.id);
                const isApproved = approved.includes(m.id);
                
                const card = document.createElement('div');
                card.className = `materia ${isApproved ? 'approved' : ''} ${(!ok && !isApproved) ? 'locked' : ''}`;
                
                if(!ok && !isApproved) {
                    card.setAttribute('data-tooltip', "Falta: " + missing.join(", "));
                } else {
                    card.onclick = () => toggleMateria(m.id);
                    card.setAttribute('data-tooltip', isApproved ? "Click para desmarcar" : "Click para aprobar");
                }

                card.innerHTML = `
                    <span class="materia-name">${m.name}</span>
                    <span class="materia-credits">${m.cred} Créditos</span>
                `;
                col.appendChild(card);
            });
            container.appendChild(col);
        });
    }

    function resetProgreso() {
        if(confirm("¿Borrar todo el progreso?")) {
            approved = [];
            localStorage.removeItem('iqProgreso');
            render();
        }
    }

    render();
</script>
</body>
</html>
